<div x-show="showModal" x-transition class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-[900px] p-6 relative">
      <h2 class="text-lg font-semibold mb-4">Nova Conta</h2>

      <!-- Fechar -->
      <button @click="modalclose()" class="absolute top-3 right-3 text-gray-500 hover:text-black">✖</button>
      {% csrf_token %}
      <!-- Conteúdo -->
      <form  @submit.prevent="submitForm">
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-gray-500">Descrição</label>
           <input type="text" name="description" x-model="formData.description" required class="border-b">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-gray-500" >Valor inicial:</label>
              <input type="number" name="value" id="value" placeholder="R$ 200000" x-model="formData.value" @input="handleBaseValueChange($event.target.value)" required class="border-b" inputmode="decimal" step="any">
            </div>
            <div>
              <label class="block text-sm text-gray-500">Data do Vencimento:</label>
              <input type="date" name="due_date" id="due_date" required x-model="formData.due_date" class="border-b">
            </div>
          </div>
          <div>
            <!--metodos de pagamento-->
            <label class="block text-sm font-medium mb-2" for="payment_method">Método de pagamento</label>
         <div class="relative w-64"
          @mouseenter="openPaymentDropdown = true"
          @mouseleave="openPaymentDropdown = false">
          <!-- Botão -->
          <button type="button"
                  class="w-full flex justify-between items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-700 shadow-sm hover:border-gray-700 focus:border-gray-700 focus:ring-2 focus:ring-gray-700 transition">
            <span>
              <template x-if="formData.payment_method">
                <span>
                  {% for payment in payment_methods %}
                    <span x-show="formData.payment_method == {{payment.id}}">
                      {{payment.method|title}}
                    </span>
                  {% endfor %}
                </span>
              </template>
            </span>
            <i data-lucide="chevron-down" class="h-5 w-5 text-gray-400"></i>
          </button>
          <!-- Dropdown -->
          <ul x-show="openPaymentDropdown"
              x-transition
              class="absolute left-0 w-full rounded-lg border border-gray-200 bg-white shadow-lg z-50">
            {% for payment in payment_methods %}
            <li @click="formData.payment_method = {{payment.id}}; openPaymentDropdown = false"
                class="cursor-pointer px-3 py-2 hover:bg-gray-700 hover:text-white transition duration-200 ease-in-out transform hover:translate-x-1 rounded-lg"
                :class="{ 'bg-gray-100 font-semibold': formData.payment_method == {{payment.id}} }">
              {{payment.method|title}}
            </li>
            {% endfor %}
          </ul>
  <!-- Hidden input para enviar ID no backend -->
  <input type="hidden" name="payment_method" :value="formData.payment_method">
</div>
          </div>
          <!-- Recorrente -->
          <div class="flex items-center gap-2">
            <input type="checkbox" name="appellant" id="appellant" x-model="formData.appellant" class="h-4 w-4 text-green-500 border-gray-300 rounded">
            <label for="appellant" class="text-sm">Tornar recorrente</label>
          </div>
          <!-- Desconto/Multa -->
         {% include 'components/_apply_discount.html' %}
          <!-- Total -->
          <div class="flex-col">
            <label class="text-sm">Total a pagar:</label>
            <input type="number" class="font-bold text-sm boder-b" id="total_value" name="total_value" x-model="formData.total_value" readonly>
          </div>
          <!-- Ações -->
          <div class="flex justify-center gap-4 pt-4">
<!-- Botões quando for CREATE -->
    <template x-if="mode === 'create'">
        <div class="flex gap-4">
          <button 
                type="button"
                class="px-4 py-2 w-32 rounded-lg bg-gray-500 text-white"
                @click="modalclose()">
                Cancelar
            </button>
            {% for status in status_bill %}
                {% if status.status == 'PENDENTE' %}
                    <button 
                        type="submit"
                        class="px-4 py-2 w-32 rounded-lg bg-green-600 text-white"
                        @click="formData.status = {{ status.id }}">
                        Salvar
                    </button>
                {% endif %}
            {% endfor %}
        </div>
    </template>

    <!-- Botões quando for UPDATE -->
    <template x-if="mode === 'update'">
        <div class="flex gap-4">
            <button 
                type="button"
                class="px-4 py-2 w-32 rounded-lg bg-gray-500 text-white"
                @click="modalclose()">
                Cancelar
            </button>
            <button 
                type="submit"
                class="px-4 py-2 w-32 rounded-lg bg-green-600 text-white">
                Salvar
            </button>
        </div>
    </template>
          </div>
        </div>
      </form>
    </div>
  </div>
