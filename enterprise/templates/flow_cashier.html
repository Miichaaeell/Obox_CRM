{% extends "_base.html" %}
{% load format_extras %}
{% load static %}
{% block title %}Fluxo de Caixa{% endblock %}

{% block content %}
<div class="w-full max-w-7xl mx-auto p-6" x-data="flowCashier()">

  <!-- Header -->
  <div class="flex gap-5 text-white mb-4">
    <div>
      <span class="font-semibold">Situação:</span>
      <span class="text-green-400">Aberto</span>
    </div>
    <div>
      <span class="font-semibold">Data de abertura:</span>
      <span class="font-bold">01/09/2025 - 00h00</span>
    </div>
    {{title}}
  </div>

  <!-- Card principal -->
  <div class="bg-transparent rounded-3xl shadow-xl border-2 border-black p-4">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-white border-none">
        <thead>
          <tr class="border-b ">
            <th class="text-left py-2 px-3 font-semibold">Fluxo de Caixa</th>
            {% for cashier in cashiers %}
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">{{cashier.created_at|date:'d-M-Y'}}</td>
              {% endif %}
            {% endfor %}
          </tr>
        </thead>
        <tbody class="text-gray-200">
          <tr class="">
            <th class="px-3 py-2 text-left ">Saldo Inicial</th>
            {% for cashier in cashiers %}
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">R$ {{cashier.opening_balance|floatformat:2}}</td>
              {% endif %}
            {% endfor %}
            
          </tr>
          <tr >
            <th class="px-3 py-2 text-left ">Receitas</th>
            {% for cashier in cashiers %}
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">R$ {{cashier.total_incomes|floatformat:2}}</td>
              {% endif %}
            {% endfor %}
            
          </tr>
          <tr >
            <th class="px-3 py-2 text-left ">Despesas</th>
            {% for cashier in cashiers %}
              
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">R$ {{cashier.total_expenses|floatformat:2}}</td>
              {% endif %}
            {% endfor %}
            
          </tr>
          <tr >
            <th class="px-3 py-2 text-left ">Lucro/Prejuízo</th>
            {% for cashier in cashiers %}
              
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">R$ {{cashier.total_incomes|subtract:cashier.total_expenses}}</td>
              {% endif %}
            {% endfor %}
           
          </tr>
          <tr>
            <th class="px-3 py-2 text-left ">Acumulado</th>
            {% for cashier in cashiers %}
              
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">R$ {{cashier.closing_balance|floatformat:2}}</td>
              {% endif %}
            {% endfor %}
            
          </tr>
          <tr >
            <th class="px-3 py-2 text-left ">Lucratividade</th>
            {% for cashier in cashiers %}
              
              {% if cashier.status == 'closed' %}
                <td class="px-3 py-2">{{cashier.total_incomes|calculate_lucrativity:cashier.total_expenses}} %</td>
              {% endif %}
            {% endfor %}
            
          </tr>
          <!-- linha dos botões -->
          <tr>
            <td class="px-3 py-2"></td>
            {% for cashier in cashiers %}
              {% if cashier.status == 'closed' %}
             <td class="px-3 py-2">
              <button @click="donwloadRelatorio({{cashier.id}}, {{url_download}})"  class="px-3 py-1 bg-green-600 rounded text-white text-xs flex items-center gap-1 hover:bg-green-700 hover:scale-105 transition-transform hover:shadow-lg hover:cursor-pointer">
                Download ⬇️
              </button>
            </td>
              {% endif %}
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Navegação -->
    <div class="flex justify-end gap-2 mt-4">
      <a href="#" class="p-1 bg-black text-white font-bold cursor-pointer rounded-full hover:bg-black/60"><i data-lucide="arrow-left" class="w-5 h-5"></i></a>
      <a href="#" class="p-1 bg-black text-white font-bold cursor-pointer rounded-full hover:bg-black/60"><i data-lucide="arrow-right" class="w-5 h-5"></i></a>
    </div>
  </div>
</div>
{% include 'components/_notification_modal.html' %}
<script src="{% static 'js/flow_cashier.js' %}"></script>
{% endblock %}
